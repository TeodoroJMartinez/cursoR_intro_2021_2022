```{r echo = FALSE}
library(knitr)

# Color text
colorize <- function(x, color) {
  
  if (knitr::is_latex_output()) {
    
    sprintf("\\textcolor{%s}{%s}", color, x)
    
  } else if (knitr::is_html_output()) {
    
    sprintf("<span style='color: %s;'>%s</span>", color, x)
    
  } else { x }
}
```


# Resumiendo y relacionado los datos {#resumenes}

Ahora que **ya sabemos depurar y transformar los datos** con pocas l√≠neas de c√≥digo, as√≠ como extraer la informaci√≥n que nos interese, en esta secci√≥n vamos a aprender dos cosas b√°sicas a la hora de trabajar con datos:

* Realizar **res√∫menes num√©ricos** de los datos, de forma general pero tambi√©n cuando queremos calcular estad√≠sticas desagregadas por grupos.
* **Relacionar tablas** entre s√≠ (los famosos _join_).


## Tablas de frecuencias

Una de las **primeras cosas** que uno aprende en la asignatura de estad√≠stica **descriptiva** es **saber resumir nuestros datos** cuando tenemos muchos, y adem√°s **muchos valores repetidos**. Vamos a construir la **tabla de frecuencias** de la variable `n_films` de nuestro ya conocido conjunto `starwars` (una variable que vamos a crear contando en cu√°ntas pel√≠culas aparece cada personaje)

```{r}
library(purrr)
library(tidyverse)
starwars_nueva <- starwars %>%
  mutate(n_films = map_int(films, length))
```

Y lo primero es **contar**: ¬øcu√°ntos registros hay de cada una de las clases? Para ello usaremos la funci√≥n `count()`

```{r}
starwars_nueva %>% count()
```

Como ves si aplicamos la **funci√≥n directamente** simplemente nos **cuenta el n√∫mero de filas** de la tabla, as√≠ que vamos a **usar la misma funci√≥n pero indic√°ndole la variable**.

```{r}
tabla_freq <- starwars_nueva %>% count(n_films)
tabla_freq
```

Esa columna `n` es lo que conocemos como **frecuencias absolutas**, el **n√∫mero de veces** que la variable toma dicha valor. Tambi√©n es posible **calcular las frecuencias absolutas** por varias variables a la vez (algo similar a una **tabla de contigencia** aunque en otro formato).

```{r}
starwars_nueva %>% count(sex, gender)
```

**¬øC√≥mo seguir construyendo nuestra tabla de frecuencias en `tabla_freq`?** Necesitamos a√±adir una columna `N_i` de **frecuencia absoluta acumulada**, una columna que nos diga el **n√∫mero de personajes que han hecho un n√∫mero de pel√≠culas igual o menor** que el indicado.


```{r}
# Construimos de cero
tabla_freq <- starwars_nueva %>%
  # n: frecuencia absoluta
  count(n_films) %>%
  # N_i: frecuencia absoluta acumulada
  mutate(N_i = cumsum(n)) # cumsum calcula la suma acumulada
tabla_freq
```

Tambi√©n **necesitamos otras dos columnas** `f_i` y `F_i`, de **frecuencias relativas** (no acumulada y acumulada, respectivamente), que nos indica lo mismo que las dos primeras columnas pero en **proporci√≥n** respecto a los datos.

```{r}
# Construimos de cero
tabla_freq <- starwars_nueva %>%
  # n: frecuencia absoluta
  count(n_films) %>%
  # N_i: frecuencia absoluta acumulada
  mutate(N_i = cumsum(n)) %>% # cumsum calcula la suma acumulada
  mutate(f_i = prop.table(n), # prop.table nos devuelve proporciones
         F_i = cumsum(f_i))
tabla_freq
```

Esas **frecuencias relativas** quiz√°s querramos tenerlas expresadas en **porcentajes** en lugar de en proporciones.

```{r}
# Pasamos frecuencias relativas a porcentajes
tabla_freq %>% mutate(f_i = f_i * 100,
                      F_i = F_i * 100)
```

Por √∫ltimo, con la tabla `tabla_freq` expresando las frecuencias relativas en proporciones, vamos a cambiar el nombre de las columnas para que tengan los **t√≠picos nombres de una tabla de frecuencias**.

```{r}
# Renombramos
tabla_freq <- tabla_freq %>%
  rename(n_i = n, x_i = n_films)
tabla_freq
```

```{r, echo = FALSE, message = FALSE}
library(DT)
datatable(options =
            list(pageLength = 10, scrollX = TRUE,
                 fixedColumns = list(leftColumns = 1),
                 headerCallback = DT::JS(
                   "function(thead) {",
                   "  $(thead).css('font-size', '0.95em');",
                   "}"
                   ),
                 language =
                   list(url = '//cdn.datatables.net/plug-ins/1.10.11/i18n/Spanish.json')),
          tabla_freq, rownames = FALSE,
          caption = "Tabla de frecuencias del n√∫mero de pel√≠culas en las que aparecen los personajes de la saga.") %>%
   formatRound(c("f_i", "F_i"), digits = 3, mark = ".",
                 dec.mark = getOption("OutDec"))
```

Con esta tabla podemos **calcular por ejemplo la media** $\overline{x}$ **usando el resumen que tenemos guardado** (como se suele - o sol√≠a - hacer cuando se tiene que realizar ¬´a mano¬ª un ejercicio de este tipo en los primeros cursos de estad√≠stica).

$$\overline{x} = \frac{1}{N} \sum_{i=1}^{k} n_i x_i = \sum_{i=1}^{k} f_i x_i$$

```{r}
library(glue)

# Renombramos
tabla_freq <- tabla_freq %>% mutate(f_i_x_i = f_i * x_i)
media <- sum(tabla_freq$f_i_x_i)
print(glue("La media de pel√≠culas es {round(media, 3)}"))
```

&nbsp;

**¬øC√≥mo construir una tabla similar para variables continuas?** La metodolog√≠a ser√≠a la misma solo que antes debemos **agrupar los datos** (por ejemplo, de la variable `height`) en **subintervalos**.

```{r}
# Construimos de cero
tabla_freq_continua <-
  starwars %>%
  # agrupamos los datos en tramos de 20 en 20
  mutate(intervalo = cut(height, breaks = seq(65, 265, by = 20))) %>%
  # n: frecuencia absoluta
  count(intervalo) %>%
  # N_i: frecuencia absoluta acumulada
  mutate(N_i = cumsum(n)) %>% # cumsum calcula la suma acumulada
  mutate(f_i = prop.table(n), # prop.table nos devuelve proporciones
         F_i = cumsum(f_i))
tabla_freq_continua
```

El problema es que **cuando agrupamos los datos de una varibale continua en subintervalos**, aunque nos sirva como **resumen** para tener una idea de como se comporta nuestra variable (y sea **algo necesario para, por ejemplo, construir un ¬´histograma discretizado¬ª**), a la hora de calcular sus estad√≠sticas perdemos informaci√≥n ya que todos los elementos que cae en un intervalo se les **imputar√° un √∫nico valor: la marca de clase, que normalmente es el punto medio del intervalo**.

Vamos a **calcular res√∫menes num√©ricos** de las variables sin agrupar aprovechando que `R` el trabajo por nosotros/as.

## Res√∫menes num√©ricos (summarise y skimr) y por grupos (group_by)

en breve

## Relacionar datos (joins)

en breve

## üìù Ejercicios

en breve

